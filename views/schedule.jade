extends layout

block content
  div(class="panel panel-info")
    div(class="panel-heading")
      h4 #{schedule.scheduleName}
    div(class="panel-body")
      p(style="white-space:pre;") #{schedule.memo}
    div(class="panel-footer")
      p 作成者: #{schedule.user.username}
  - var isMine = parseInt(user.id) === schedule.user.userId
  if isMine
    div
      a(class="btn btn-info" href="/schedules/#{schedule.scheduleId}/edit") この予定を編集する
  h3 出欠表
  table(class="table table-bordered")
    tr
      th 予定
      each user in users
        th #{user.username}
    - var priorityNum = [0]; //出席者数
    - var candidatesCount = 0; //候補の番号
    each candidate in candidates
      - priorityNum[candidatesCount] = 0; //出席者数を初期化
      tr
        th #{candidate.candidateName}
        each user in users
          - var availability = availabilityMapMap.get(user.userId).get(candidate.candidateId)
          - var availabilityLabels = ['欠', '？', '出'];
          - var buttonStyles = ['btn-danger', 'btn-default', 'btn-success'];
          - var tdAvailabilityClasses = ['bg-danger', 'bg-default', 'bg-success'];

          - priorityNum[candidatesCount] += availability === 2 ? 1 : 0; // 出席者数を記録

          td(class="#{tdAvailabilityClasses[availability]}")
            if user.isSelf
              button(class="availability-toggle-button btn-lg #{buttonStyles[availability]}"
                data-schedule-id="#{schedule.scheduleId}"
                data-user-id="#{user.userId}"
                data-candidate-id="#{candidate.candidateId}"
                data-availability="#{availability}") #{availabilityLabels[availability]}
            else
              h3 #{availabilityLabels[availability]}
      th 出席者予定者数 => #{priorityNum[candidatesCount]}
      - candidatesCount++;
    tr
      th コメント 
      each user in users
        if user.isSelf
          td
            p
              small(id="self-comment") #{commentMap.get(user.userId)}
            button(class="btn-xs btn-info"
              id="self-comment-button"
              data-schedule-id="#{schedule.scheduleId}"
              data-user-id="#{user.userId}") 編集
        else
          td
            p
              small #{commentMap.get(user.userId)}
